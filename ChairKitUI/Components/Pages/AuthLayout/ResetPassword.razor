@page "/reset-password"
@layout AuthLayout
@using System.ComponentModel.DataAnnotations
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar

<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        font-family: 'Poppins', sans-serif;
        background: url('images/sea-beach.jpg') center/cover no-repeat fixed;
        overflow-x: hidden;
    }

    * {
        box-sizing: border-box;
    }

    .login-container {
        backdrop-filter: blur(8px);
        background-color: rgba(255, 255, 255, 0.1);
        max-width: 90vw;
        min-width: 300px;
        width: 100%;
    }

    .header-section {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(8px);
    }

    .chair-icon {
        transform: rotate(-15deg);
    }

    .text-blue-100 {
        color: #bfdbfe;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .mud-paper {
        animation: fadeIn 0.7s ease-out;
    }

    .bg-gradient-to-r {
        background: linear-gradient(to right, #10B981, #059669);
    }

    .from-blue-500 {
        background: linear-gradient(to right, #3B82F6, #7C3AED);
    }

    @@media (max-width: 600px) {
        html, body {
            background-position: center 60%;
        }

        .login-container {
            max-width: 95vw;
            padding: 10px;
        }
    }

    @@media (min-width: 601px) and (max-width: 960px) {
        html, body {
            background-position: center 50%;
        }

        .login-container {
            max-width: 70vw;
        }
    }

    @@media (min-width: 961px) {
        html, body {
            background-position: center 50%;
        }

        .login-container {
            max-width: 450px;
        }
    }

    .gif-container {
        height: 100%;
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        margin-top: 24px;
    }

        .gif-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
</style>
<MudContainer Class="d-flex align-center" Style="min-height: 100vh; padding: 20px; margin: 0; position: absolute; top: 0; left: 0; right: 0;">
    <div style="width: 100%; max-width: 1200px; margin-left: 10vw;">
        <MudPaper Class="login-container rounded-3xl pa-0" Elevation="10" Style="background-color: rgba(255, 255, 255, 0.01); backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.2);">
            <div class="header-section pa-8 text-center" Style="background: rgba(255, 255, 255, 0.01); backdrop-filter: blur(8px);">
                <MudAvatar Class="mb-4" Style="background: rgba(255, 255, 255, 0.2);" Size="Size.Large">
                    <MudImage Src="images/icon.png" Alt="icon chair"></MudImage>
                </MudAvatar>
                <MudText Typo="Typo.h5" Color="Color.Inherit" Class="font-bold text-white" Style="text-shadow: 0 0 4px rgba(0, 0, 0, 0.5);"><b>Reset Password</b></MudText>
                <MudText Typo="Typo.body1" Color="Color.Inherit" Class="mt-2 text-blue-100" Style="text-shadow: 0 0 4px rgba(0, 0, 0, 0.5);"><b>Enter your new password</b></MudText>
            </div>

            <!-- Form Section -->
            <MudForm Class="pa-8 mud-form" Style="background: rgba(255, 255, 255, 0.01);" Model="resetPassword" ValidationDelay="0">

                <MudTextField @bind-Value="resetPassword.OTP" AutoFocus
                              Label="OTP" Variant="Variant.Outlined" Class="mb-6"
                              Style="background: rgba(255, 255, 255, 0.5);" Clearable="true"
                              AdornmentAriaLabel="Show Password" />

                <MudTextField @bind-Value="resetPassword.NewPassword" AutoFocus
                              Label="New Password" Variant="Variant.Outlined" Class="mb-6"
                              Style="background: rgba(255, 255, 255, 0.5);" Clearable="true"
                              InputType="@PasswordInput" Adornment="Adornment.End"
                              AdornmentIcon="@PasswordInputIcon" OnAdornmentClick="TogglePasswordVisibility"
                              AdornmentAriaLabel="Show Password" />

                <MudTextField @bind-Value="resetPassword.ConfirmPassword"
                              Label="Confirm Password" Variant="Variant.Outlined" Class="mb-6"
                              Style="background: rgba(255, 255, 255, 0.5);" Clearable="true"
                              InputType="@PasswordInput" Adornment="Adornment.End"
                              AdornmentIcon="@PasswordInputIcon" OnAdornmentClick="TogglePasswordVisibility"
                              AdornmentAriaLabel="Show Password" />

                <div class="d-flex align-center justify-space-between mb-6">
                    <MudLink Href="/" Underline="Underline.Hover" Color="Color.Primary" Typo="Typo.caption"><b>Back to Sign In</b></MudLink>
                </div>

                <MudButton Variant="Variant.Filled" Color="Color.Info" Class="w-100 py-3" StartIcon="@Icons.Material.Filled.LockReset" OnClick="SubmitResetPassword">Reset Password</MudButton>
            </MudForm>
        </MudPaper>
    </div>
</MudContainer>
@code {
    private ResetPasswordRequest resetPassword = new ResetPasswordRequest();
    private bool isShow;
    private InputType PasswordInput = InputType.Password;
    private string PasswordInputIcon = Icons.Material.Filled.VisibilityOff;


    private void TogglePasswordVisibility()
    {
        if (isShow)
        {
            isShow = false;
            PasswordInputIcon = Icons.Material.Filled.VisibilityOff;
            PasswordInput = InputType.Password;
        }
        else
        {
            isShow = true;
            PasswordInputIcon = Icons.Material.Filled.Visibility;
            PasswordInput = InputType.Text;
        }
    }

    private async Task SubmitResetPassword()
    {
        Snackbar.Add("Password reset successful", Severity.Success);
        await Task.Delay(1000);
        NavigationManager.NavigateTo("/");
    }

    public class ResetPasswordRequest
    {
        [Required]
        public string OTP { get; set; }

        [Required]
        [StringLength(100, MinimumLength = 6, ErrorMessage = "Password must be at least 6 characters long")]
        public string NewPassword { get; set; }

        [Required]
        [Compare(nameof(NewPassword), ErrorMessage = "Passwords do not match")]
        public string ConfirmPassword { get; set; }
    }
}